2020-12-11 16:20:00.587 +00:00 [INF] Request starting HTTP/1.1 POST https://localhost:44394/api/user/update application/json 123
2020-12-11 16:20:00.759 +00:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2020-12-11 16:20:01.186 +00:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.HandleAsync(RequestDelegate next, HttpContext context, AuthorizationPolicy policy, PolicyAuthorizationResult authorizeResult)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.SwaggerUiIndexMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.RedirectToIndexMiddleware.Invoke(HttpContext context)
   at NSwag.AspNetCore.Middlewares.OpenApiDocumentMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Builder.Extensions.MapWhenMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Builder.Extensions.MapMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2020-12-11 16:20:01.316 +00:00 [INF] Request finished HTTP/1.1 POST https://localhost:44394/api/user/update application/json 123 - 500 - text/plain 733.6106ms
2020-12-11 16:38:05.062 +00:00 [INF] User profile is available. Using 'C:\Users\kemal\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2020-12-11 16:38:05.338 +00:00 [INF] Request starting HTTP/1.1 POST https://localhost:44394/api/user/authenticate application/json 50
2020-12-11 16:38:05.915 +00:00 [INF] Executing endpoint 'Blog.Api.Controllers.UserController.Authenticate (Blog.Api)'
2020-12-11 16:38:05.986 +00:00 [INF] Route matched with {action = "Authenticate", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Authenticate(Blog.Logic.UserAggregate.Querries.AuthenticateUser.AuthenticateUserRequest) on controller Blog.Api.Controllers.UserController (Blog.Api).
2020-12-11 16:38:06.101 +00:00 [INF] Blog Request: AuthenticateUserRequest  {"Email":"para@mela.com","Password":"123456","$type":"AuthenticateUserRequest"}
2020-12-11 16:38:07.252 +00:00 [WRN] There are multiple relationships between 'Entry' and 'Content' without configured foreign key properties. This will cause Entity Framework to create shadow properties on 'Entry' with names dependent on the discovery order.
2020-12-11 16:38:07.621 +00:00 [INF] Entity Framework Core 5.0.1 initialized 'BlogContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2020-12-11 16:38:08.707 +00:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[UserId], [u].[Email], [u].[FirstName], [u].[LastName], [u].[Password], [u].[Username], [r].[Token], [r].[CreatedAt], [r].[ExpiresAt], [r].[OwnerId], [r].[OwnerIp], [r].[RevokedAt]
FROM [Users] AS [u]
LEFT JOIN [RefreshTokens] AS [r] ON [u].[UserId] = [r].[OwnerId]
ORDER BY [u].[UserId], [r].[Token]
2020-12-11 16:38:08.914 +00:00 [WRN] Blog Long Running Request: AuthenticateUserRequest (2786 milliseconds)  {"Email":"para@mela.com","Password":"123456","$type":"AuthenticateUserRequest"}
2020-12-11 16:38:09.224 +00:00 [INF] Blog Request: GenerateRefreshTokenRequest  {"UserId":"1f285bf8-3e78-47eb-8b39-e896d1a328cf","ClientIp":"0.0.0.1","$type":"GenerateRefreshTokenRequest"}
2020-12-11 16:38:09.599 +00:00 [INF] Executed DbCommand (54ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (DbType = DateTime2), @p2='?' (DbType = DateTime2), @p3='?' (Size = 450), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RefreshTokens] ([Token], [CreatedAt], [ExpiresAt], [OwnerId], [OwnerIp], [RevokedAt])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2020-12-11 16:38:09.687 +00:00 [INF] Executing OkObjectResult, writing value of type 'Blog.Api.Controllers.AuthenticatedUserModel'.
2020-12-11 16:38:09.726 +00:00 [INF] Executed action Blog.Api.Controllers.UserController.Authenticate (Blog.Api) in 3733.3416ms
2020-12-11 16:38:09.729 +00:00 [INF] Executed endpoint 'Blog.Api.Controllers.UserController.Authenticate (Blog.Api)'
2020-12-11 16:38:09.751 +00:00 [INF] Request finished HTTP/1.1 POST https://localhost:44394/api/user/authenticate application/json 50 - 200 - application/json;+charset=utf-8 4415.4262ms
2020-12-11 16:38:15.393 +00:00 [INF] Request starting HTTP/1.1 POST https://localhost:44394/api/user/update application/json 123
2020-12-11 16:38:15.588 +00:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo: 'System.DateTime', Current time: 'System.DateTime'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, JwtSecurityToken jwtToken, TokenValidationParameters validationParameters)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateTokenPayload(JwtSecurityToken jwtToken, TokenValidationParameters validationParameters)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateToken(String token, TokenValidationParameters validationParameters, SecurityToken& validatedToken)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2020-12-11 16:38:15.629 +00:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo: 'System.DateTime', Current time: 'System.DateTime'.
2020-12-11 16:38:15.636 +00:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2020-12-11 16:38:15.646 +00:00 [INF] AuthenticationScheme: Bearer was challenged.
2020-12-11 16:38:15.653 +00:00 [INF] Request finished HTTP/1.1 POST https://localhost:44394/api/user/update application/json 123 - 401 - - 260.5255ms
2020-12-11 16:39:08.984 +00:00 [INF] Request starting HTTP/1.1 POST https://localhost:44394/api/user/update application/json 123
2020-12-11 16:39:09.014 +00:00 [INF] Successfully validated the token.
2020-12-11 16:39:09.016 +00:00 [INF] Authorization was successful.
2020-12-11 16:39:09.017 +00:00 [INF] Executing endpoint 'Blog.Api.Controllers.UserController.Update (Blog.Api)'
2020-12-11 16:39:09.027 +00:00 [INF] Route matched with {action = "Update", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Update(Blog.Logic.UserAggregate.Commands.CreateUser.UpdateUserRequest) on controller Blog.Api.Controllers.UserController (Blog.Api).
2020-12-11 16:39:15.853 +00:00 [INF] Blog Request: UpdateUserRequest  {"UserId":"1f285bf8-3e78-47eb-8b39-e896d1a328cf","UserName":"Aston_Villa","FirstName":"Aston","LastName":null,"Email":null,"Password":"123456","Phones":[],"$type":"UpdateUserRequest"}
2020-12-11 16:39:15.901 +00:00 [INF] Entity Framework Core 5.0.1 initialized 'BlogContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2020-12-11 16:39:15.971 +00:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[UserId], [t].[Email], [t].[FirstName], [t].[LastName], [t].[Password], [t].[Username], [r].[Token], [r].[CreatedAt], [r].[ExpiresAt], [r].[OwnerId], [r].[OwnerIp], [r].[RevokedAt]
FROM (
    SELECT TOP(1) [u].[UserId], [u].[Email], [u].[FirstName], [u].[LastName], [u].[Password], [u].[Username]
    FROM [Users] AS [u]
    WHERE [u].[UserId] = @__p_0
) AS [t]
LEFT JOIN [RefreshTokens] AS [r] ON [t].[UserId] = [r].[OwnerId]
ORDER BY [t].[UserId], [r].[Token]
2020-12-11 16:39:16.006 +00:00 [INF] Executing HttpStatusCodeResult, setting HTTP status code 200
2020-12-11 16:39:16.007 +00:00 [INF] Executed action Blog.Api.Controllers.UserController.Update (Blog.Api) in 6979.4706ms
2020-12-11 16:39:16.007 +00:00 [INF] Executed endpoint 'Blog.Api.Controllers.UserController.Update (Blog.Api)'
2020-12-11 16:39:16.009 +00:00 [INF] Request finished HTTP/1.1 POST https://localhost:44394/api/user/update application/json 123 - 200 - - 7025.0529ms
